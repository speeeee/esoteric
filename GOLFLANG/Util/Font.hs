module Util.Font (tinySquare, switchPath, drawLetter, drawString, Dir(..)) where

import Graphics.Rendering.OpenGL.Raw

data Dir = DownLeft | DownRight | UpRight | UpLeft

(%) = mod

-- "building blocks" for the characters.

-- tinySquare: it is as its name suggests. (0.2Ã—0.2)
tinySquare :: (GLfloat,GLfloat) -> GLfloat -> IO ()
tinySquare (x,y) s = do
  --glColor3f 1 1 1
  glBegin gl_QUADS
  mapM_ (\(x',y') -> glVertex3f (x+x'*s) (y+y'*s) 0) [(0,0),(1,0),(1,1),(0,1)]
  glEnd

-- switchPath: curves the suggested path of a line elsewhere.
switchPath :: (GLfloat,GLfloat) -> Dir -> GLfloat -> IO ()
switchPath (x,y) dest s = do
  let lst = map ((*) (pi/2)) [0.05,0.1..0.95]
  --glColor3f 1 1 1
  glBegin gl_POLYGON
  mapM_ (\(x',y') -> glVertex3f (x+x') (y+y') 0)
    (case dest of DownLeft -> [(0,s),(s,s)] ++ (map (\k -> ((s*cos k),(-s*sin k+s))) lst) ++ [(0,0)]
                  DownRight -> [(s,s),(0,s)] ++ (map (\k -> ((-s*cos k+s),(-s*sin k+s))) lst) ++ [(s,0)]
                  UpLeft -> [(0,0),(s,0)] ++ (map (\k -> ((s*cos k),(s*sin k))) lst) ++ [(0,s)]
                  UpRight -> [(s,0),(0,0)] ++ (map (\k -> ((-s*cos k+s),(s*sin k))) lst) ++ [(s,s)])
  glEnd

drawLetter (x,y) c s = do
  let l = letter c
  mapM_ (\(n,t) -> if t == 0 then return ()
                   else if t == 1 then tinySquare ((x+((fromIntegral $ n%5)::GLfloat)*s),(y-((fromIntegral $ n `div` 5)::GLfloat)*s)) s
                   else switchPath ((x+((fromIntegral $ n%5)::GLfloat)*s),(y-((fromIntegral $ n `div` 5)::GLfloat)*s))
                          (case t of 2 -> DownLeft
                                     3 -> DownRight
                                     4 -> UpRight
                                     5 -> UpLeft) s)
        (zip [(0::Int)..] l)

drawString :: (GLfloat,GLfloat) -> String -> GLfloat -> IO ()
drawString (x,y) str s = do
  mapM_ (\(n,c) -> drawLetter (x+5.2*n*s,y) c s) (zip [0..] str)

-- ignore the ugly code...

-- 0: nothing
-- 1: tinySquare
-- 2: DownLeft
-- 3: DownRight
-- 4: UpRight
-- 5: UpLeft
letter c = case c of ' ' -> [0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0]
                     'a' -> [0,0,0,0,0,
                             4,1,1,1,5,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             3,1,1,1,1]
                     'b' -> [5,0,0,0,0,
                             1,0,0,0,0,
                             1,1,1,1,5,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     'c' -> [0,0,0,0,0,
                             4,1,1,1,5,
                             1,0,0,0,1,
                             1,0,0,0,0,
                             3,1,1,1,2]
                     'd' -> [0,0,0,0,5,
                             0,0,0,0,1,
                             4,1,1,1,1,
                             1,0,0,0,1,
                             3,1,1,1,3]
                     'f' -> [0,0,4,1,5,
                             0,0,1,0,0,
                             0,1,1,1,0,
                             0,0,1,0,0,
                             3,1,2,0,0]
                     'e' -> [0,0,0,0,0,
                             4,1,1,1,5,
                             1,1,1,1,1,
                             1,0,0,0,0,
                             3,1,1,1,2]
                     'g' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             3,1,1,1,2,
                             0,0,0,0,1,
                             3,1,1,1,2]
                     'h' -> [4,5,0,0,0,
                             0,1,0,0,0,
                             0,1,1,1,5,
                             0,1,0,0,1,
                             0,1,0,0,3]
                     'i' -> [0,0,1,0,0,
                             0,0,0,0,0,
                             0,4,5,0,0,
                             0,0,1,0,0,
                             0,0,3,2,0]
                     'j' -> [0,0,0,1,0,
                             0,0,0,0,0,
                             0,0,0,1,0,
                             1,0,0,1,0,
                             3,1,1,2,0]
                     'k' -> [4,5,0,0,0,
                             0,1,0,4,0,
                             0,1,1,2,0,
                             0,1,1,5,0,
                             0,1,0,3,0]
                     'l' -> [0,4,5,0,0,
                             0,0,1,0,0,
                             0,0,1,0,0,
                             0,0,1,0,0,
                             0,0,3,2,0]
                     'm' -> [0,0,0,0,0,
                             1,1,4,1,4,
                             1,0,1,0,1,
                             1,0,1,0,1,
                             1,0,1,0,1]
                     'n' -> [0,0,0,0,0,
                             1,1,1,1,4,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             1,0,0,0,1]
                     'o' -> [0,0,0,0,0,
                             4,1,1,1,5,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     'p' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             1,1,1,1,2,
                             1,0,0,0,0,
                             1,0,0,0,0]
                     'q' -> [4,1,1,5,0,
                             1,0,0,1,0,
                             3,1,1,1,0,
                             0,0,0,1,0,
                             0,0,0,3,2]
                     'r' -> [0,0,0,0,0,
                             5,1,1,1,5,
                             1,0,0,0,1,
                             1,0,0,0,0,
                             1,0,0,0,0]
                     's' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             3,1,1,1,5,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     't' -> [0,0,5,0,0,
                             0,0,1,0,0,
                             0,1,1,1,0,
                             0,0,1,0,0,
                             0,0,3,2,0]
                     'u' -> [0,0,0,0,0,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             3,1,1,1,1]
                     'v' -> [0,0,0,0,0,
                             5,0,0,0,4,
                             3,5,0,4,2,
                             0,3,1,2,0,
                             0,0,1,0,0]
                     'w' -> [0,0,0,0,0,
                             1,0,1,0,1,
                             1,0,1,0,1,
                             1,0,1,0,1,
                             3,1,3,1,1]
                     'x' -> [0,0,0,0,0,
                             3,5,0,4,2,
                             0,3,1,2,0,
                             0,4,1,5,0,
                             4,2,0,3,5]
                     'y' -> [0,0,0,0,0,
                             1,0,0,0,1,
                             3,1,1,1,1,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     'z' -> [0,0,0,0,0,
                             4,1,1,1,5,
                             0,0,4,2,0,
                             0,4,2,0,0,
                             3,1,1,1,2]
                     '.' -> [0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             4,5,0,0,0,
                             3,2,0,0,0]
                     '(' -> [4,1,0,0,0,
                             1,0,0,0,0,
                             1,0,0,0,0,
                             1,0,0,0,0,
                             3,1,0,0,0]
                     ')' -> [0,0,0,1,5,
                             0,0,0,0,1,
                             0,0,0,0,1,
                             0,0,0,0,1,
                             0,0,0,1,2]
                     '0' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     '1' -> [0,0,4,0,0,
                             0,3,1,0,0,
                             0,0,1,0,0,
                             0,0,1,0,0,
                             0,1,1,1,0]
                     '2' -> [4,1,1,1,5,
                             1,0,0,4,2,
                             0,0,4,2,0,
                             0,4,2,0,0,
                             1,1,1,1,1]
                     '3' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             0,0,1,1,1,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     '4' -> [1,0,0,0,1,
                             1,0,0,0,1,
                             3,1,1,1,1,
                             0,0,0,0,1,
                             0,0,0,0,1]
                     '5' -> [1,1,1,1,1,
                             1,0,0,0,0,
                             3,1,1,1,5,
                             0,0,0,0,1,
                             3,1,1,1,2]
                     '6' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             1,1,1,1,5,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     '7' -> [4,1,1,1,1,
                             0,0,0,0,1,
                             0,0,0,4,2,
                             0,0,0,1,0,
                             0,0,0,1,0]
                     '8' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             1,1,1,1,1,
                             1,0,0,0,1,
                             3,1,1,1,2]
                     '9' -> [4,1,1,1,5,
                             1,0,0,0,1,
                             1,1,1,1,1,
                             0,0,0,0,1,
                             3,1,1,1,2]
                     ',' -> [0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             4,5,0,0,0,
                             0,2,0,0,0]
                     ';' -> [0,0,0,0,0,
                             0,1,0,0,0,
                             0,0,0,0,0,
                             4,5,0,0,0,
                             0,2,0,0,0]
                     _   -> [0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0,
                             0,0,0,0,0]

